package com.zyrtec.tugofwar.view.screens.highscores{	import com.greensock.*;	import com.greensock.TweenMax;	import com.greensock.easing.*;	import com.greensock.plugins.*;	import com.theginbin.ui.RollOverButton;	import com.theginbin.utils.BasicFrameTimer;	import com.theginbin.utils.TimeConverter;	import com.zyrtec.events.ZyrtecGameEvent;	import com.zyrtec.model.MiniGameModel;	import com.zyrtec.tugofwar.model.TOWModel;	import com.zyrtec.view.Leaderboard;		import flash.display.MovieClip;	import flash.display.Sprite;	import flash.events.Event;	import flash.events.EventDispatcher;	import flash.events.IEventDispatcher;	import flash.events.MouseEvent;	import flash.events.TimerEvent;	import flash.external.ExternalInterface;	import flash.net.URLRequest;	import flash.net.navigateToURL;	import flash.utils.Timer;		import com.zyrtec.analytics.Tracking;		// =================================================	// ================ @Class	// =================================================	public class TOWLeaderboard extends Leaderboard	{		// =================================================		// ================ @Constructor		// =================================================		public function TOWLeaderboard(leaderboardClipMC:MovieClip, gameModel:MiniGameModel)		{			super(leaderboardClipMC, gameModel);		}				// =================================================		// ================ @Callable		// =================================================				//FUNCTION : SET THE LEADERBOARD STATIC TEXT		override public function setStaticText():void {			if (model.isLoggedIn) {  //gray these out				leaderboardClip.signupAreaMC.alpha = 0.4;			}						leaderboardClip.txtLoading.alpha = 1;						leaderboardClip.txtTimeComplete.txt.autoSize = "right";			if (!TOWModel(model).wonGame) {				leaderboardClip.txtTimeComplete.txt.text = "Incomplete";			} else {				leaderboardClip.txtTimeComplete.txt.text = model.displayScore;			}						//display stars earned 			leaderboardClip.txtMinutes.txt.autoSize = "left";			leaderboardClip.txtStars.txt.autoSize = "left";						var minutes:uint = TOWModel(model).score/60000;			if (minutes < 2) { //3 stars				leaderboardClip.star1.gotoAndStop(2);				leaderboardClip.star2.gotoAndStop(2);				leaderboardClip.star3.gotoAndStop(2);				leaderboardClip.txtMinutes.txt.text = "< 2 minutes.";				leaderboardClip.txtStars.txt.text = "3 stars";				model.stars = 3;			} else if (minutes >= 2 && minutes < 3){ //2 stars				leaderboardClip.star1.gotoAndStop(2);				leaderboardClip.star2.gotoAndStop(2);				leaderboardClip.txtMinutes.txt.text = "< 3 minutes.";				leaderboardClip.txtStars.txt.text = "2 stars";				model.stars = 2;			} else if (minutes >=3){ //1 star				leaderboardClip.star1.gotoAndStop(2);				leaderboardClip.txtMinutes.txt.text = "> 3 minutes.";				leaderboardClip.txtStars.txt.text = "1 star";				model.stars = 1;			}						if (!TOWModel(model).wonGame) {				leaderboardClip.star1.gotoAndStop(1);				leaderboardClip.star2.gotoAndStop(1);				leaderboardClip.star3.gotoAndStop(1);				leaderboardClip.txtMinutes.txt.text = "INCOMPLETE";				leaderboardClip.txtStars.txt.text = "0 stars";				model.stars = 0;			}		}				//FUNCTION : SET THE LEADERBOARD DYNAMIC TEXT -- OVERRIDING BECAUSE SCORES ARRAY SHOULD BE ASCENDING AND BACKEND RETURNS DESCENDING		override public function setLeaderboardText():void {			//trace("results obj = "+model.leaderboardResults);			trace("SETTING LEADERBOARD TEXT");			TweenMax.to(leaderboardClip.txtLoading, 0.4, {alpha:0});						var i:int;			if (playerHolder.numChildren>0) { //clear out the leaderboard data before this animates in				var clip:MovieClip;				for (i = 0; i < playerHolder.numChildren; i++) {					clip = MovieClip(playerHolder.getChildAt(i));					clip.visible = false;					clip = null;				}			}						var resultsObj:Object = model.leaderboardResults;						if (!model.isLoggedIn || !resultsObj.hasOwnProperty("TopScore") || resultsObj.TopScore==null || resultsObj.TopScore==undefined) {				if (!TOWModel(model).wonGame) {					leaderboardClip.txtYourRank.txtTime.text = "Incomplete"; 				} else {					leaderboardClip.txtYourRank.txtTime.text = model.displayScore; 				}			} else {				if (resultsObj.TopScore=="-1") {					leaderboardClip.txtYourRank.txtTime.text = "Incomplete"; 				} else {					leaderboardClip.txtYourRank.txtTime.text = getPlayerScoreDisplay(resultsObj.TopScore); 				}			}						/*if (resultsObj.hasOwnProperty("Rank") && resultsObj.Rank!=null && resultsObj.Rank!=undefined) {			leaderboardClip.txtYourRank.txtRank.text = resultsObj.Rank;			} else {			leaderboardClip.txtYourRank.txtRank.text = "";			}*/						if (resultsObj.hasOwnProperty("SessionName") && resultsObj.SessionName!=null && resultsObj.SessionName!=undefined) {				leaderboardClip.txtSession.txt.text = resultsObj.SessionName;			}						//start the session countdown clock			if (resultsObj.hasOwnProperty("TimeLeft") && resultsObj.TimeLeft!=null && resultsObj.TimeLeft!=undefined) {				sessionTime = resultsObj.TimeLeft;				if (sessionTime>1000) { //only use the timer if the time left is greater than 1 second					if(sessionTimer==null) {						sessionTimer = new Timer(1000);					}					sessionTimer.addEventListener(TimerEvent.TIMER, onSessionTimer);					sessionTimer.start();				}			}						//populate the leaderboard			var leaderboardPlayer:MovieClip;			var spacing:uint = 10;			var rank:String;			var scoresLength:int;			if (resultsObj.hasOwnProperty("Scores") && resultsObj.Scores!=null && resultsObj.Scores!=undefined) {				scoresLength = resultsObj.Scores.length;								for (i=0; i<resultsObj.Scores.length; i++) { //just grab first 5 players					leaderboardPlayer = new LeaderboardPlayerMC();					trace("SCORES ARRAY -- looping through array and i == "+i+" and order == "+resultsObj.Scores[(scoresLength-1)-i].order+" and name == "+resultsObj.Scores[(scoresLength-1)-i].name+" and score == "+getPlayerScoreDisplay(resultsObj.Scores[(scoresLength-1)-i].score));					leaderboardPlayer.txtRank.text = (i+1).toString();//resultsObj.Scores[i].order; //assuming "order" will correspond to the order of the array					leaderboardPlayer.txtName.text = resultsObj.Scores[(scoresLength-1)-i].name;					leaderboardPlayer.txtScore.text = getPlayerScoreDisplay(resultsObj.Scores[(scoresLength-1)-i].score);										leaderboardPlayer.y = (leaderboardPlayer.height+spacing)*i;										playerHolder.addChild(leaderboardPlayer);				}			}						//fade in			TweenMax.to(playerHolder, 0.4, {alpha:1, delay:0.4});			TweenMax.to(leaderboardClip.txtYourRank, 0.4, {alpha:1, delay:0.4});			TweenMax.delayedCall(0.4, addReloadEvents);		}				//FUNCTION : ON FACEBOOK SHARE CLICK		override public function onFacebookShareClick(e:MouseEvent):void{ //share page on facebook			var title:String ="I just unlocked the Strong Arm Badge! I'm unbeatable!";			var copy:String;			if (TOWModel(model).wonGame) {				copy = "I earned "+model.stars+" stars for finishing Tug-of-War in only "+model.displayScore+" at ZYRTEC%26reg; Parks Unleashed%26trade;. Top that!";			} else {				copy = "I earned 0 stars for almost completing Tug-of-War at ZYRTEC%26reg; Parks Unleashed%26trade;. Oh well!";			}			var url:String = "http://www.facebook.com/sharer.php?s=100&p[title]="+title+"&p[url]="+model.shareURL+"&p[images][0]="+model.badgeURL+"&p[summary]="+copy;			if (ExternalInterface.available){				ExternalInterface.call("openPopup", url, "ShareFacebook", Leaderboard.POP_UP_WIDTH, Leaderboard.POP_UP_HEIGHT);			}else navigateToURL(new URLRequest(url), "_blank");						Tracking.track(Tracking.L2_SHARE_STRONGARM);		}	}}